# Understanding Profiles

Learn how zprof manages shell configurations through profiles.

## What is a Profile?

A **profile** is a complete, self-contained zsh configuration including:
- A framework (oh-my-zsh, zimfw, prezto, zinit, or zap)
- A theme or prompt engine
- Plugins and extensions
- Environment variables
- Custom shell options

Each profile lives in its own directory and can be activated independently.

## Why Use Profiles?

**Multiple Contexts**: Different workflows need different configurations:
- **Work**: Corporate proxy settings, company Git config, Kubernetes tools
- **Personal**: Fun themes, experimental plugins, personal aliases
- **Minimal**: Fast startup, bare essentials for SSH sessions
- **Experimental**: Test new frameworks without breaking your main setup

**Easy Switching**: Change your entire shell environment with one command:
```bash
zprof use work
exec zsh
```

**Safe Experimentation**: Try new frameworks, themes, or plugins without risk:
```bash
zprof create test-profile
# Try it out...
zprof delete test-profile  # Nope, didn't like it
```

## Profile Structure

Each profile is stored in `~/.zsh-profiles/profiles/<name>/`:

```
~/.zsh-profiles/
├── profiles/
│   ├── work/
│   │   ├── profile.toml          # Manifest (source of truth)
│   │   ├── .zshrc                # Generated shell config
│   │   ├── .zshenv               # Environment setup
│   │   ├── .oh-my-zsh/           # Framework installation
│   │   └── .zshrc.pre-zprof      # Backup from migration
│   └── personal/
│       └── [same structure]
├── shared/
│   ├── .zsh_history              # Shared across all profiles
│   └── custom.zsh                # Shared customizations
├── cache/
│   └── backups/                  # Automatic backups
└── config.toml                   # Global config (active profile)
```

### The Manifest (profile.toml)

The **manifest** is the single source of truth for a profile:

```toml
[profile]
name = "work"
framework = "oh-my-zsh"
theme = "robbyrussell"
created = "2025-11-01T10:00:00Z"
modified = "2025-11-15T14:30:00Z"

[plugins]
enabled = ["git", "docker", "kubectl", "zsh-autosuggestions", "zsh-syntax-highlighting"]

[env]
EDITOR = "vim"
NODE_ENV = "development"
AWS_PROFILE = "work-account"
```

**Key principle**: Shell configs (`.zshrc`, `.zshenv`) are **generated** from the manifest. Don't edit them directly—edit `profile.toml` instead.

### Generated Shell Configs

When you create or modify a profile, zprof generates:

1. **`.zshrc`**: Framework initialization, plugin loading, theme activation
2. **`.zshenv`**: Environment variables, shared history configuration

These files include a warning header:
```bash
# ============================================================
# AUTO-GENERATED by zprof - DO NOT EDIT DIRECTLY
# Generated: 2025-11-20 10:30:00
# From: /Users/you/.zsh-profiles/profiles/work/profile.toml
# ============================================================
```

If you want to make changes, edit `profile.toml` and run:
```bash
zprof regenerate work
```

## How Profile Switching Works

zprof uses zsh's `ZDOTDIR` environment variable to switch profiles:

1. **Normal zsh**: Sources `~/.zshrc`
2. **With zprof**: Sources `$ZDOTDIR/.zshrc`

When you run `zprof use work`, it updates `~/.zshenv`:

```bash
# ========== Managed by zprof ==========
export ZDOTDIR="$HOME/.zsh-profiles/profiles/work"
export HISTFILE="$HOME/.zsh-profiles/shared/.zsh_history"
setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY
# =======================================
```

Next time you start zsh, it automatically uses the work profile!

**Your original `~/.zshrc` remains untouched.** This is why zprof is non-destructive.

## Shared Resources

### Shared History

All profiles share the same command history by default:

```
~/.zsh-profiles/shared/.zsh_history
```

**Why?** So commands you run in one profile are available in all others. This is usually what you want.

**Don't want shared history?** Edit `profile.toml`:

```toml
[env]
HISTFILE = "$ZDOTDIR/.zsh_history"  # Profile-specific history
```

### Shared Customizations

Add custom aliases, functions, or settings that apply to **all** profiles:

```bash
# Edit shared customizations
vim ~/.zsh-profiles/shared/custom.zsh
```

Example:
```bash
# Aliases
alias ll='ls -lah'
alias gs='git status'
alias dc='docker-compose'

# Functions
mkcd() {
    mkdir -p "$1" && cd "$1"
}

# Environment
export GPG_TTY=$(tty)
```

Every profile automatically sources `custom.zsh` at the end of its `.zshrc`.

## Profile Lifecycle

### 1. Creation

```bash
zprof create myprofile
```

Creates directory structure, installs framework, generates configs.

### 2. Activation

```bash
zprof use myprofile
```

Updates `~/.zshenv` to point `ZDOTDIR` to this profile.

### 3. Customization

```bash
zprof edit myprofile
```

Edit `profile.toml`, zprof auto-regenerates shell configs.

### 4. Export/Share

```bash
zprof export myprofile
```

Creates portable `.zprof` archive.

### 5. Deletion

```bash
zprof delete myprofile
```

Removes profile directory (after creating backup).

## Advanced Concepts

### Framework Installation

Each profile can have its own framework installation:

```
profiles/work/.oh-my-zsh/      # oh-my-zsh for work profile
profiles/personal/.zim/        # zimfw for personal profile
```

This means you can try different frameworks without interference!

### Profile Migration

When you run `zprof init`, it can migrate your existing setup:

1. Detects framework (oh-my-zsh, zimfw, etc.)
2. Parses your `.zshrc` for plugins and theme
3. Creates a profile mirroring your current setup
4. Backs up original `.zshrc` as `.zshrc.pre-zprof`

Your original files remain in `~/` for safety.

### Manifest Validation

zprof validates `profile.toml` whenever you edit it:

**Valid framework names:**
- `oh-my-zsh`
- `zimfw`
- `prezto`
- `zinit`
- `zap`

**Valid plugin names:** Must exist in the plugin registry (600+ plugins)

**Valid theme names:** Must exist in the theme registry or be a valid prompt engine

If validation fails, zprof shows helpful error messages and preserves your old configs.

## Best Practices

### Naming Profiles

Use descriptive names:
- ✅ `work`, `personal`, `minimal`, `client-xyz`
- ❌ `test`, `new`, `temp`, `asdf`

### Organization

Consider these profile strategies:

**By Context:**
```
work        # Corporate environment
personal    # Home usage
server      # Minimal for SSH
```

**By Framework:**
```
omz-default     # oh-my-zsh setup
zimfw-fast      # zimfw for speed
zinit-advanced  # zinit for power users
```

**By Project:**
```
client-acme     # Client-specific tools
project-apollo  # Project environment
```

### Backup Strategy

Export important profiles regularly:

```bash
# Weekly backup
zprof export work --output ~/backups/work-$(date +%Y%m%d).zprof
```

Consider version controlling your profiles:

```bash
cd ~/.zsh-profiles/profiles/work
git init
git add profile.toml
git commit -m "Initial work profile"
```

### Performance

Profile switching is instant (< 100ms), but shell startup time depends on:
- Framework choice (zinit > zap > zimfw > prezto > oh-my-zsh)
- Number of plugins (fewer is faster)
- Theme choice (async prompts like Starship are faster)

Check startup time:
```bash
time zsh -i -c exit
```

## Troubleshooting

### Profile not activating

After `zprof use <name>`, you must start a new shell:
```bash
exec zsh
```

Or simply open a new terminal window.

### Lost which profile is active

```bash
zprof current
```

### Broke a profile

Regenerate from manifest:
```bash
zprof regenerate <name>
```

Or delete and recreate:
```bash
zprof delete broken-profile
zprof create fixed-profile
```

### Want to start fresh

```bash
zprof rollback              # Restore original config
rm -rf ~/.zsh-profiles/     # Remove all profiles
zprof init                  # Start over
```

## Next Steps

- [Command Reference](commands.md) - Learn all profile management commands
- [Supported Frameworks](frameworks.md) - Deep dive into each framework
- [Troubleshooting](troubleshooting.md) - Solutions to common problems
