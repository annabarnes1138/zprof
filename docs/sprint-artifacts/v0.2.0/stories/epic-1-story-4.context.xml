<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>4</storyId>
    <title>Create Prompt Engine Selection TUI</title>
    <status>drafted</status>
    <generatedAt>2025-11-20</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/planning/v0.2.0/stories/epic-1-story-4.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>user who chose "Standalone prompt engine"</asA>
    <iWant>to select which engine to use</iWant>
    <soThat>I can pick the prompt that fits my needs</soThat>
    <tasks>
      - Create prompt engine selection TUI module
      - Display list of engines with descriptions
      - Show Nerd Font warning when applicable
      - Implement keyboard navigation
      - Return selected PromptEngine enum
    </tasks>
  </story>

  <acceptanceCriteria>
    - [ ] Create `src/tui/prompt_engine_select.rs`
    - [ ] Display list of engines with descriptions
    - [ ] Show warning if engine requires Nerd Font
    - [ ] Return selected `PromptEngine`
    - [ ] Keyboard navigation
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/planning/v0.2.0/epic-1-smart-tui.md</path>
        <title>Epic 1: Smart TUI</title>
        <section>Story 1.4</section>
        <snippet>Shows UI example with engine list including Starship, Powerlevel10k, Oh-My-Posh, Pure, and Spaceship with descriptions indicating features like cross-shell, async, etc.</snippet>
      </doc>
    </docs>

    <code>
      <artifact>
        <path>src/tui/theme_select.rs</path>
        <kind>module</kind>
        <symbol>run_theme_selection</symbol>
        <lines>1-50</lines>
        <reason>Reference implementation for list-based selection TUI - similar pattern needed for engine selection.</reason>
      </artifact>
      <artifact>
        <path>src/prompts/engine.rs</path>
        <kind>module</kind>
        <symbol>PromptEngine, EngineMetadata</symbol>
        <lines>N/A</lines>
        <reason>Engine registry created in Story 1.3 - source of engine list and metadata for display.</reason>
      </artifact>
    </code>

    <dependencies>
      <rust>
        <package name="ratatui" version="0.29.0" purpose="Terminal UI"/>
        <package name="crossterm" version="0.29.0" purpose="Terminal events"/>
      </rust>
    </dependencies>
  </artifacts>

  <constraints>
    - Follow TUI patterns from theme_select.rs
    - Display engine metadata: name, description, requirements
    - Show visual indicator (icon/text) for Nerd Font requirement
    - Only called when user selected PromptEngine mode in Story 1.2
    - Return PromptEngine enum variant
  </constraints>

  <interfaces>
    <interface>
      <name>run_prompt_engine_selection</name>
      <kind>function</kind>
      <signature>pub fn run_prompt_engine_selection() -> Result&lt;PromptEngine&gt;</signature>
      <path>src/tui/prompt_engine_select.rs</path>
      <notes>Main TUI entry point for selecting a prompt engine</notes>
    </interface>
  </interfaces>

  <tests>
    <standards>
      TUI screens tested via integration tests. Focus on verifying correct PromptEngine variant returned.
    </standards>
    <locations>
      - Unit tests: src/tui/prompt_engine_select.rs #[cfg(test)] mod tests
      - Integration: tests/create_workflow_test.rs
    </locations>
    <ideas>
      <test ac="Return PromptEngine">
        <idea>Test selecting each engine returns correct enum variant</idea>
      </test>
      <test ac="Nerd Font warning">
        <idea>Integration test verifying warning appears for engines requiring Nerd Font</idea>
      </test>
    </ideas>
  </tests>
</story-context>
